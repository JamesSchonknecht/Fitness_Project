---
title: "Macrofactor Excel File Cleaning"
output: html_notebook
---

## Goal

The purpose of this notebook is to create a workflow that reformats new excel workbook files
from the Macrofactor app to match their old formatting.

This is so data import into Power BI continues to work following changes in excel workbook structure.

```{r message=FALSE, warning=FALSE}
# Load libraries
library(tidyverse)
library(readxl)
library(writexl)
library(purrr)
```

Finding old worksheet names in old and new workbooks
```{r}
old_file_path <- '../data/MacroFactor_data.xlsx'
new_file_path <- '../data/MacroFactor-20250530134512.xlsx'

old_sheet_names <- excel_sheets(old_file_path)
new_sheet_names <- excel_sheets(new_file_path)
```

```{r}
old_sheet_names
```
```{r}
new_sheet_names
```
For each worksheet in old Excel workbook, find column headers
```{r}
old_col_names_list <- list()

for (sheet in old_sheet_names) {
  # cat('\nSheet:', sheet, '\n')
  df <- read_excel(path='../data/MacroFactor_data.xlsx', sheet=sheet, n_max=0)
  old_col_names_list[[sheet]] <- names(df)
}
```

For each worksheet in new Excel workbook, find column headers
```{r}
new_col_names_list <- list()

for (sheet in new_sheet_names) {
  # cat('\nSheet:', sheet, '\n')
  df <- read_excel(path='../data/MacroFactor-20250530134512.xlsx', sheet=sheet, n_max=0)
  new_col_names_list[[sheet]] <- names(df)
}
```


```{r}
all_new_data <- list()

for (sheet in new_sheet_names) {
  df <- read_excel(path=new_file_path, sheet=sheet)
  all_new_data[[sheet]] <- df
}

```

